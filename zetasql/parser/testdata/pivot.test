# Simple PIVOT
SELECT * FROM t PIVOT(SUM(a) FOR b IN (0, 1));
--
QueryStatement [0-45] [SELECT * FROM...IN (0, 1))]
  Query [0-45] [SELECT * FROM...IN (0, 1))]
    Select [0-45] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-45] [FROM t PIVOT...IN (0, 1))]
        TablePathExpression [14-45] [t PIVOT(SUM...IN (0, 1))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-45] [PIVOT(SUM(a) FOR b IN (0, 1))]
            PivotExpressionList [22-28] [SUM(a)]
              PivotExpression [22-28] [SUM(a)]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
            PathExpression [33-34] [b]
              Identifier(b) [33-34] [b]
            PivotValueList [39-43] [0, 1]
              PivotValue [39-40] [0]
                IntLiteral(0) [39-40] [0]
              PivotValue [42-43] [1]
                IntLiteral(1) [42-43] [1]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) FOR b IN (0, 1))
==

# Simple PIVOT with single-element IN-list
SELECT * FROM t PIVOT(SUM(a) FOR b IN (0));
--
QueryStatement [0-42] [SELECT * FROM...b IN (0))]
  Query [0-42] [SELECT * FROM...b IN (0))]
    Select [0-42] [SELECT * FROM...b IN (0))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-42] [FROM t PIVOT...b IN (0))]
        TablePathExpression [14-42] [t PIVOT(SUM(a) FOR b IN (0))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-42] [PIVOT(SUM(a) FOR b IN (0))]
            PivotExpressionList [22-28] [SUM(a)]
              PivotExpression [22-28] [SUM(a)]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
            PathExpression [33-34] [b]
              Identifier(b) [33-34] [b]
            PivotValueList [39-40] [0]
              PivotValue [39-40] [0]
                IntLiteral(0) [39-40] [0]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) FOR b IN (0))
==

# Multiple pivot exprs
SELECT * FROM t PIVOT(SUM(a), SUM(b) FOR b IN (0, 1));
--
QueryStatement [0-53] [SELECT * FROM...IN (0, 1))]
  Query [0-53] [SELECT * FROM...IN (0, 1))]
    Select [0-53] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-53] [FROM t PIVOT...IN (0, 1))]
        TablePathExpression [14-53] [t PIVOT(SUM...IN (0, 1))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-53] [PIVOT(SUM(...IN (0, 1))]
            PivotExpressionList [22-36] [SUM(a), SUM(b)]
              PivotExpression [22-28] [SUM(a)]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
              PivotExpression [30-36] [SUM(b)]
                FunctionCall [30-36] [SUM(b)]
                  PathExpression [30-33] [SUM]
                    Identifier(SUM) [30-33] [SUM]
                  PathExpression [34-35] [b]
                    Identifier(b) [34-35] [b]
            PathExpression [41-42] [b]
              Identifier(b) [41-42] [b]
            PivotValueList [47-51] [0, 1]
              PivotValue [47-48] [0]
                IntLiteral(0) [47-48] [0]
              PivotValue [50-51] [1]
                IntLiteral(1) [50-51] [1]
--
SELECT
  *
FROM
  t PIVOT(SUM(a), SUM(b) FOR b IN (0, 1))
==

# Complex pivot exprs
SELECT * FROM t PIVOT(SUM(a) + SUM(b), COUNT(*), COUNT(DISTINCT c)
FOR b IN (0, 1));
--
QueryStatement [0-83] [SELECT * FROM...IN (0, 1))]
  Query [0-83] [SELECT * FROM...IN (0, 1))]
    Select [0-83] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-83] [FROM t PIVOT...IN (0, 1))]
        TablePathExpression [14-83] [t PIVOT(SUM...IN (0, 1))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-83] [PIVOT(SUM(...IN (0, 1))]
            PivotExpressionList [22-66] [SUM(a) + SUM...DISTINCT c)]
              PivotExpression [22-37] [SUM(a) + SUM(b)]
                BinaryExpression(+) [22-37] [SUM(a) + SUM(b)]
                  FunctionCall [22-28] [SUM(a)]
                    PathExpression [22-25] [SUM]
                      Identifier(SUM) [22-25] [SUM]
                    PathExpression [26-27] [a]
                      Identifier(a) [26-27] [a]
                  FunctionCall [31-37] [SUM(b)]
                    PathExpression [31-34] [SUM]
                      Identifier(SUM) [31-34] [SUM]
                    PathExpression [35-36] [b]
                      Identifier(b) [35-36] [b]
              PivotExpression [39-47] [COUNT(*)]
                FunctionCall [39-47] [COUNT(*)]
                  PathExpression [39-44] [COUNT]
                    Identifier(COUNT) [39-44] [COUNT]
                  Star(*) [45-46] [*]
              PivotExpression [49-66] [COUNT(DISTINCT c)]
                FunctionCall(distinct=true) [49-66] [COUNT(DISTINCT c)]
                  PathExpression [49-54] [COUNT]
                    Identifier(COUNT) [49-54] [COUNT]
                  PathExpression [64-65] [c]
                    Identifier(c) [64-65] [c]
            PathExpression [71-72] [b]
              Identifier(b) [71-72] [b]
            PivotValueList [77-81] [0, 1]
              PivotValue [77-78] [0]
                IntLiteral(0) [77-78] [0]
              PivotValue [80-81] [1]
                IntLiteral(1) [80-81] [1]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) + SUM(b), COUNT(*), COUNT(DISTINCT c) FOR b IN (0, 1))
==

# pivot expression with alias
# (mixed with another pivot expression without alias)
SELECT * FROM t PIVOT(SUM(a) AS sum_a, COUNT(b) FOR x IN (0, 1));
--
QueryStatement [0-64] [SELECT * FROM...IN (0, 1))]
  Query [0-64] [SELECT * FROM...IN (0, 1))]
    Select [0-64] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-64] [FROM t PIVOT...IN (0, 1))]
        TablePathExpression [14-64] [t PIVOT(SUM...IN (0, 1))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-64] [PIVOT(SUM(...IN (0, 1))]
            PivotExpressionList [22-47] [SUM(a) AS sum_a, COUNT(b)]
              PivotExpression [22-37] [SUM(a) AS sum_a]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-37] [AS sum_a]
                  Identifier(sum_a) [32-37] [sum_a]
              PivotExpression [39-47] [COUNT(b)]
                FunctionCall [39-47] [COUNT(b)]
                  PathExpression [39-44] [COUNT]
                    Identifier(COUNT) [39-44] [COUNT]
                  PathExpression [45-46] [b]
                    Identifier(b) [45-46] [b]
            PathExpression [52-53] [x]
              Identifier(x) [52-53] [x]
            PivotValueList [58-62] [0, 1]
              PivotValue [58-59] [0]
                IntLiteral(0) [58-59] [0]
              PivotValue [61-62] [1]
                IntLiteral(1) [61-62] [1]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum_a, COUNT(b) FOR x IN (0, 1))
==

# pivot value with alias (mixed with another pivot value without alias)
SELECT * FROM t PIVOT(SUM(a) AS sum_a, COUNT(b) FOR x IN (0 AS zero, 1));
--
QueryStatement [0-72] [SELECT * FROM...zero, 1))]
  Query [0-72] [SELECT * FROM...zero, 1))]
    Select [0-72] [SELECT * FROM...zero, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-72] [FROM t PIVOT...zero, 1))]
        TablePathExpression [14-72] [t PIVOT(SUM...zero, 1))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-72] [PIVOT(SUM(...zero, 1))]
            PivotExpressionList [22-47] [SUM(a) AS sum_a, COUNT(b)]
              PivotExpression [22-37] [SUM(a) AS sum_a]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-37] [AS sum_a]
                  Identifier(sum_a) [32-37] [sum_a]
              PivotExpression [39-47] [COUNT(b)]
                FunctionCall [39-47] [COUNT(b)]
                  PathExpression [39-44] [COUNT]
                    Identifier(COUNT) [39-44] [COUNT]
                  PathExpression [45-46] [b]
                    Identifier(b) [45-46] [b]
            PathExpression [52-53] [x]
              Identifier(x) [52-53] [x]
            PivotValueList [58-70] [0 AS zero, 1]
              PivotValue [58-67] [0 AS zero]
                IntLiteral(0) [58-59] [0]
                Alias [60-67] [AS zero]
                  Identifier(zero) [63-67] [zero]
              PivotValue [69-70] [1]
                IntLiteral(1) [69-70] [1]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum_a, COUNT(b) FOR x IN (0 AS zero, 1))
==

# PIVOT on join input (comma join)
SELECT * FROM t1,t2 PIVOT(SUM(a) FOR b IN (0, 1));
--
QueryStatement [0-49] [SELECT * FROM...IN (0, 1))]
  Query [0-49] [SELECT * FROM...IN (0, 1))]
    Select [0-49] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-49] [FROM t1,t2...IN (0, 1))]
        Join(COMMA) [14-49] [t1,t2 PIVOT...IN (0, 1))]
          TablePathExpression [14-16] [t1]
            PathExpression [14-16] [t1]
              Identifier(t1) [14-16] [t1]
          Location [16-17] [,]
          TablePathExpression [17-49] [t2 PIVOT(SUM...IN (0, 1))]
            PathExpression [17-19] [t2]
              Identifier(t2) [17-19] [t2]
            PivotClause [20-49] [PIVOT(SUM(a) FOR b IN (0, 1))]
              PivotExpressionList [26-32] [SUM(a)]
                PivotExpression [26-32] [SUM(a)]
                  FunctionCall [26-32] [SUM(a)]
                    PathExpression [26-29] [SUM]
                      Identifier(SUM) [26-29] [SUM]
                    PathExpression [30-31] [a]
                      Identifier(a) [30-31] [a]
              PathExpression [37-38] [b]
                Identifier(b) [37-38] [b]
              PivotValueList [43-47] [0, 1]
                PivotValue [43-44] [0]
                  IntLiteral(0) [43-44] [0]
                PivotValue [46-47] [1]
                  IntLiteral(1) [46-47] [1]
--
SELECT
  *
FROM
  t1,
  t2 PIVOT(SUM(a) FOR b IN (0, 1))
==

# PIVOT on a parenthesized join is not supported.
# The proper way to PIVOT on a join result is to wrap the join result in a
# subquery.
SELECT * FROM (t1 INNER JOIN t2 USING(x)) PIVOT(SUM(a) FOR b IN (0, 1));
--
ERROR: Syntax error: Expected end of input but got keyword PIVOT [at 1:43]
SELECT * FROM (t1 INNER JOIN t2 USING(x)) PIVOT(SUM(a) FOR b IN (0, 1));
                                          ^
==

# PIVOT on join input (inner join)
SELECT * FROM t1 INNER JOIN t2 PIVOT(SUM(a) FOR b IN (0, 1)) USING(x);
--
QueryStatement [0-69] [SELECT * FROM...) USING(x)]
  Query [0-69] [SELECT * FROM...) USING(x)]
    Select [0-69] [SELECT * FROM...) USING(x)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-69] [FROM t1 INNER...) USING(x)]
        Join(INNER) [14-69] [t1 INNER JOIN...) USING(x)]
          TablePathExpression [14-16] [t1]
            PathExpression [14-16] [t1]
              Identifier(t1) [14-16] [t1]
          Location [17-27] [INNER JOIN]
          TablePathExpression [28-60] [t2 PIVOT(SUM...IN (0, 1))]
            PathExpression [28-30] [t2]
              Identifier(t2) [28-30] [t2]
            PivotClause [31-60] [PIVOT(SUM(a) FOR b IN (0, 1))]
              PivotExpressionList [37-43] [SUM(a)]
                PivotExpression [37-43] [SUM(a)]
                  FunctionCall [37-43] [SUM(a)]
                    PathExpression [37-40] [SUM]
                      Identifier(SUM) [37-40] [SUM]
                    PathExpression [41-42] [a]
                      Identifier(a) [41-42] [a]
              PathExpression [48-49] [b]
                Identifier(b) [48-49] [b]
              PivotValueList [54-58] [0, 1]
                PivotValue [54-55] [0]
                  IntLiteral(0) [54-55] [0]
                PivotValue [57-58] [1]
                  IntLiteral(1) [57-58] [1]
          UsingClause [61-69] [USING(x)]
            Identifier(x) [67-68] [x]
--
SELECT
  *
FROM
  t1
  INNER JOIN
  t2 PIVOT(SUM(a) FOR b IN (0, 1))
  USING(x)
==

# PIVOT on join input (cross join)
SELECT * FROM t1 CROSS JOIN t2 PIVOT(SUM(a) FOR b IN (0, 1));
--
QueryStatement [0-60] [SELECT * FROM...IN (0, 1))]
  Query [0-60] [SELECT * FROM...IN (0, 1))]
    Select [0-60] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-60] [FROM t1 CROSS...IN (0, 1))]
        Join(CROSS) [14-60] [t1 CROSS JOIN...IN (0, 1))]
          TablePathExpression [14-16] [t1]
            PathExpression [14-16] [t1]
              Identifier(t1) [14-16] [t1]
          Location [17-27] [CROSS JOIN]
          TablePathExpression [28-60] [t2 PIVOT(SUM...IN (0, 1))]
            PathExpression [28-30] [t2]
              Identifier(t2) [28-30] [t2]
            PivotClause [31-60] [PIVOT(SUM(a) FOR b IN (0, 1))]
              PivotExpressionList [37-43] [SUM(a)]
                PivotExpression [37-43] [SUM(a)]
                  FunctionCall [37-43] [SUM(a)]
                    PathExpression [37-40] [SUM]
                      Identifier(SUM) [37-40] [SUM]
                    PathExpression [41-42] [a]
                      Identifier(a) [41-42] [a]
              PathExpression [48-49] [b]
                Identifier(b) [48-49] [b]
              PivotValueList [54-58] [0, 1]
                PivotValue [54-55] [0]
                  IntLiteral(0) [54-55] [0]
                PivotValue [57-58] [1]
                  IntLiteral(1) [57-58] [1]
--
SELECT
  *
FROM
  t1
  CROSS JOIN
  t2 PIVOT(SUM(a) FOR b IN (0, 1))
==

# alias on the result of the entire PIVOT
SELECT * FROM t PIVOT(SUM(a) FOR b IN (0, 1)) AS t_pivot;
--
QueryStatement [0-56] [SELECT * FROM...AS t_pivot]
  Query [0-56] [SELECT * FROM...AS t_pivot]
    Select [0-56] [SELECT * FROM...AS t_pivot]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-56] [FROM t PIVOT...AS t_pivot]
        TablePathExpression [14-56] [t PIVOT(SUM...AS t_pivot]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-56] [PIVOT(SUM(...AS t_pivot]
            PivotExpressionList [22-28] [SUM(a)]
              PivotExpression [22-28] [SUM(a)]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
            PathExpression [33-34] [b]
              Identifier(b) [33-34] [b]
            PivotValueList [39-43] [0, 1]
              PivotValue [39-40] [0]
                IntLiteral(0) [39-40] [0]
              PivotValue [42-43] [1]
                IntLiteral(1) [42-43] [1]
            Alias [46-56] [AS t_pivot]
              Identifier(t_pivot) [49-56] [t_pivot]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) FOR b IN (0, 1)) AS t_pivot
==

# PIVOT on tvf result with zero args
SELECT * FROM MyTVF() PIVOT(SUM(a) FOR b IN (0, 1));
--
QueryStatement [0-51] [SELECT * FROM...IN (0, 1))]
  Query [0-51] [SELECT * FROM...IN (0, 1))]
    Select [0-51] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-51] [FROM MyTVF...IN (0, 1))]
        TVF [14-51] [MyTVF() PIVOT...IN (0, 1))]
          PathExpression [14-19] [MyTVF]
            Identifier(MyTVF) [14-19] [MyTVF]
          PivotClause [22-51] [PIVOT(SUM(a) FOR b IN (0, 1))]
            PivotExpressionList [28-34] [SUM(a)]
              PivotExpression [28-34] [SUM(a)]
                FunctionCall [28-34] [SUM(a)]
                  PathExpression [28-31] [SUM]
                    Identifier(SUM) [28-31] [SUM]
                  PathExpression [32-33] [a]
                    Identifier(a) [32-33] [a]
            PathExpression [39-40] [b]
              Identifier(b) [39-40] [b]
            PivotValueList [45-49] [0, 1]
              PivotValue [45-46] [0]
                IntLiteral(0) [45-46] [0]
              PivotValue [48-49] [1]
                IntLiteral(1) [48-49] [1]
--
SELECT
  *
FROM
  MyTVF() PIVOT(SUM(a) FOR b IN (0, 1))
==

# PIVOT on tvf result with zero args and sample clause
SELECT * FROM MyTVF() PIVOT(SUM(a) FOR b IN (0, 1))  
  TABLESAMPLE RESERVOIR (100 ROWS) REPEATABLE(10);
--
QueryStatement [0-103] [SELECT * FROM...REPEATABLE(10)]
  Query [0-103] [SELECT * FROM...REPEATABLE(10)]
    Select [0-103] [SELECT * FROM...REPEATABLE(10)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-103] [FROM MyTVF...REPEATABLE(10)]
        TVF [14-103] [MyTVF() PIVOT...REPEATABLE(10)]
          PathExpression [14-19] [MyTVF]
            Identifier(MyTVF) [14-19] [MyTVF]
          PivotClause [22-51] [PIVOT(SUM(a) FOR b IN (0, 1))]
            PivotExpressionList [28-34] [SUM(a)]
              PivotExpression [28-34] [SUM(a)]
                FunctionCall [28-34] [SUM(a)]
                  PathExpression [28-31] [SUM]
                    Identifier(SUM) [28-31] [SUM]
                  PathExpression [32-33] [a]
                    Identifier(a) [32-33] [a]
            PathExpression [39-40] [b]
              Identifier(b) [39-40] [b]
            PivotValueList [45-49] [0, 1]
              PivotValue [45-46] [0]
                IntLiteral(0) [45-46] [0]
              PivotValue [48-49] [1]
                IntLiteral(1) [48-49] [1]
          SampleClause [56-103] [TABLESAMPLE...REPEATABLE(10)]
            Identifier(RESERVOIR) [68-77] [RESERVOIR]
            SampleSize [79-87] [100 ROWS]
              IntLiteral(100) [79-82] [100]
            SampleSuffix [89-103] [REPEATABLE(10)]
              RepeatableClause [89-103] [REPEATABLE(10)]
                IntLiteral(10) [100-102] [10]
--
SELECT
  *
FROM
  MyTVF() PIVOT(SUM(a) FOR b IN (0, 1)) TABLESAMPLE RESERVOIR(100 ROWS) REPEATABLE (10)
==

# PIVOT on tvf result with one arg
SELECT * FROM MyTVF(t) PIVOT(SUM(a) FOR b IN (0, 1));
--
QueryStatement [0-52] [SELECT * FROM...IN (0, 1))]
  Query [0-52] [SELECT * FROM...IN (0, 1))]
    Select [0-52] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-52] [FROM MyTVF...IN (0, 1))]
        TVF [14-52] [MyTVF(t) PIVOT...IN (0, 1))]
          PathExpression [14-19] [MyTVF]
            Identifier(MyTVF) [14-19] [MyTVF]
          TVFArgument [20-21] [t]
            PathExpression [20-21] [t]
              Identifier(t) [20-21] [t]
          PivotClause [23-52] [PIVOT(SUM(a) FOR b IN (0, 1))]
            PivotExpressionList [29-35] [SUM(a)]
              PivotExpression [29-35] [SUM(a)]
                FunctionCall [29-35] [SUM(a)]
                  PathExpression [29-32] [SUM]
                    Identifier(SUM) [29-32] [SUM]
                  PathExpression [33-34] [a]
                    Identifier(a) [33-34] [a]
            PathExpression [40-41] [b]
              Identifier(b) [40-41] [b]
            PivotValueList [46-50] [0, 1]
              PivotValue [46-47] [0]
                IntLiteral(0) [46-47] [0]
              PivotValue [49-50] [1]
                IntLiteral(1) [49-50] [1]
--
SELECT
  *
FROM
  MyTVF(t) PIVOT(SUM(a) FOR b IN (0, 1))
==

# PIVOT on tvf result with tablesample
SELECT * FROM MyTVF(t)
  PIVOT(SUM(a) FOR b IN (0, 1)) 
  TABLESAMPLE RESERVOIR (100 ROWS) REPEATABLE(10);
--

QueryStatement [0-105] [SELECT * FROM...REPEATABLE(10)]
  Query [0-105] [SELECT * FROM...REPEATABLE(10)]
    Select [0-105] [SELECT * FROM...REPEATABLE(10)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-105] [FROM MyTVF...REPEATABLE(10)]
        TVF [14-105] [MyTVF(t)...REPEATABLE(10)]
          PathExpression [14-19] [MyTVF]
            Identifier(MyTVF) [14-19] [MyTVF]
          TVFArgument [20-21] [t]
            PathExpression [20-21] [t]
              Identifier(t) [20-21] [t]
          PivotClause [25-54] [PIVOT(SUM(a) FOR b IN (0, 1))]
            PivotExpressionList [31-37] [SUM(a)]
              PivotExpression [31-37] [SUM(a)]
                FunctionCall [31-37] [SUM(a)]
                  PathExpression [31-34] [SUM]
                    Identifier(SUM) [31-34] [SUM]
                  PathExpression [35-36] [a]
                    Identifier(a) [35-36] [a]
            PathExpression [42-43] [b]
              Identifier(b) [42-43] [b]
            PivotValueList [48-52] [0, 1]
              PivotValue [48-49] [0]
                IntLiteral(0) [48-49] [0]
              PivotValue [51-52] [1]
                IntLiteral(1) [51-52] [1]
          SampleClause [58-105] [TABLESAMPLE...REPEATABLE(10)]
            Identifier(RESERVOIR) [70-79] [RESERVOIR]
            SampleSize [81-89] [100 ROWS]
              IntLiteral(100) [81-84] [100]
            SampleSuffix [91-105] [REPEATABLE(10)]
              RepeatableClause [91-105] [REPEATABLE(10)]
                IntLiteral(10) [102-104] [10]
--

SELECT
  *
FROM
  MyTVF(t) PIVOT(SUM(a) FOR b IN (0, 1)) TABLESAMPLE RESERVOIR(100 ROWS) REPEATABLE (10)
==

# PIVOT on tvf argument
SELECT * from MyTVF((SELECT * FROM t PIVOT(SUM(a) FOR b IN (0, 1))));
--
QueryStatement [0-68] [SELECT * from...(0, 1))))]
  Query [0-68] [SELECT * from...(0, 1))))]
    Select [0-68] [SELECT * from...(0, 1))))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-68] [from MyTVF...(0, 1))))]
        TVF [14-68] [MyTVF((SELECT...(0, 1))))]
          PathExpression [14-19] [MyTVF]
            Identifier(MyTVF) [14-19] [MyTVF]
          TVFArgument [20-67] [(SELECT *...IN (0, 1)))]
            ExpressionSubquery [20-67] [(SELECT *...IN (0, 1)))]
              Query [21-66] [SELECT * FROM...IN (0, 1))]
                Select [21-66] [SELECT * FROM...IN (0, 1))]
                  SelectList [28-29] [*]
                    SelectColumn [28-29] [*]
                      Star(*) [28-29] [*]
                  FromClause [30-66] [FROM t PIVOT...IN (0, 1))]
                    TablePathExpression [35-66] [t PIVOT(SUM...IN (0, 1))]
                      PathExpression [35-36] [t]
                        Identifier(t) [35-36] [t]
                      PivotClause [37-66] [PIVOT(SUM(a) FOR b IN (0, 1))]
                        PivotExpressionList [43-49] [SUM(a)]
                          PivotExpression [43-49] [SUM(a)]
                            FunctionCall [43-49] [SUM(a)]
                              PathExpression [43-46] [SUM]
                                Identifier(SUM) [43-46] [SUM]
                              PathExpression [47-48] [a]
                                Identifier(a) [47-48] [a]
                        PathExpression [54-55] [b]
                          Identifier(b) [54-55] [b]
                        PivotValueList [60-64] [0, 1]
                          PivotValue [60-61] [0]
                            IntLiteral(0) [60-61] [0]
                          PivotValue [63-64] [1]
                            IntLiteral(1) [63-64] [1]
--
SELECT
  *
FROM
  MyTVF((
    SELECT
      *
    FROM
      t PIVOT(SUM(a) FOR b IN (0, 1))
  ))
==

# PIVOT on subquery
SELECT * FROM (SELECT a, b, c FROM t) PIVOT(SUM(a) FOR b IN (0, 1));
--
QueryStatement [0-67] [SELECT * FROM...IN (0, 1))]
  Query [0-67] [SELECT * FROM...IN (0, 1))]
    Select [0-67] [SELECT * FROM...IN (0, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-67] [FROM (SELECT...IN (0, 1))]
        TableSubquery [14-67] [(SELECT a,...IN (0, 1))]
          Query (pivot input) [15-36] [SELECT a, b, c FROM t]
            Select [15-36] [SELECT a, b, c FROM t]
              SelectList [22-29] [a, b, c]
                SelectColumn [22-23] [a]
                  PathExpression [22-23] [a]
                    Identifier(a) [22-23] [a]
                SelectColumn [25-26] [b]
                  PathExpression [25-26] [b]
                    Identifier(b) [25-26] [b]
                SelectColumn [28-29] [c]
                  PathExpression [28-29] [c]
                    Identifier(c) [28-29] [c]
              FromClause [30-36] [FROM t]
                TablePathExpression [35-36] [t]
                  PathExpression [35-36] [t]
                    Identifier(t) [35-36] [t]
          PivotClause [38-67] [PIVOT(SUM(a) FOR b IN (0, 1))]
            PivotExpressionList [44-50] [SUM(a)]
              PivotExpression [44-50] [SUM(a)]
                FunctionCall [44-50] [SUM(a)]
                  PathExpression [44-47] [SUM]
                    Identifier(SUM) [44-47] [SUM]
                  PathExpression [48-49] [a]
                    Identifier(a) [48-49] [a]
            PathExpression [55-56] [b]
              Identifier(b) [55-56] [b]
            PivotValueList [61-65] [0, 1]
              PivotValue [61-62] [0]
                IntLiteral(0) [61-62] [0]
              PivotValue [64-65] [1]
                IntLiteral(1) [64-65] [1]
--
SELECT
  *
FROM
  (
    SELECT
      a,
      b,
      c
    FROM
      t
  ) PIVOT(SUM(a) FOR b IN (0, 1))
==

# PIVOT combined with other clauses
SELECT * FROM t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
WHERE a < 5 HAVING sum_zero = 1 LIMIT 10;
--
QueryStatement [0-101] [SELECT * FROM...1 LIMIT 10]
  Query [0-101] [SELECT * FROM...1 LIMIT 10]
    Select [0-92] [SELECT * FROM...sum_zero = 1]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-60] [FROM t PIVOT...zero, 1))]
        TablePathExpression [14-60] [t PIVOT(SUM...zero, 1))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-60] [PIVOT(SUM(...zero, 1))]
            PivotExpressionList [22-35] [SUM(a) AS sum]
              PivotExpression [22-35] [SUM(a) AS sum]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-35] [AS sum]
                  Identifier(sum) [32-35] [sum]
            PathExpression [40-41] [b]
              Identifier(b) [40-41] [b]
            PivotValueList [46-58] [0 AS zero, 1]
              PivotValue [46-55] [0 AS zero]
                IntLiteral(0) [46-47] [0]
                Alias [48-55] [AS zero]
                  Identifier(zero) [51-55] [zero]
              PivotValue [57-58] [1]
                IntLiteral(1) [57-58] [1]
      WhereClause [61-72] [WHERE a < 5]
        BinaryExpression(<) [67-72] [a < 5]
          PathExpression [67-68] [a]
            Identifier(a) [67-68] [a]
          IntLiteral(5) [71-72] [5]
      Having [73-92] [HAVING sum_zero = 1]
        BinaryExpression(=) [80-92] [sum_zero = 1]
          PathExpression [80-88] [sum_zero]
            Identifier(sum_zero) [80-88] [sum_zero]
          IntLiteral(1) [91-92] [1]
    LimitOffset [93-101] [LIMIT 10]
      IntLiteral(10) [99-101] [10]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
WHERE
  a < 5
HAVING sum_zero = 1
LIMIT 10
==

# PIVOT combined with TABLESAMPLE
SELECT * FROM
t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1)) {{AS t_pivot|}}
TABLESAMPLE RESERVOIR (100 ROWS) REPEATABLE(10)
--
ALTERNATION GROUP: AS t_pivot
--
QueryStatement [0-119] [SELECT * FROM...REPEATABLE(10)]
  Query [0-119] [SELECT * FROM...REPEATABLE(10)]
    Select [0-119] [SELECT * FROM...REPEATABLE(10)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-119] [FROM t PIVOT...REPEATABLE(10)]
        TablePathExpression [14-119] [t PIVOT(SUM...REPEATABLE(10)]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-71] [PIVOT(SUM(...AS t_pivot]
            PivotExpressionList [22-35] [SUM(a) AS sum]
              PivotExpression [22-35] [SUM(a) AS sum]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-35] [AS sum]
                  Identifier(sum) [32-35] [sum]
            PathExpression [40-41] [b]
              Identifier(b) [40-41] [b]
            PivotValueList [46-58] [0 AS zero, 1]
              PivotValue [46-55] [0 AS zero]
                IntLiteral(0) [46-47] [0]
                Alias [48-55] [AS zero]
                  Identifier(zero) [51-55] [zero]
              PivotValue [57-58] [1]
                IntLiteral(1) [57-58] [1]
            Alias [61-71] [AS t_pivot]
              Identifier(t_pivot) [64-71] [t_pivot]
          SampleClause [72-119] [TABLESAMPLE...REPEATABLE(10)]
            Identifier(RESERVOIR) [84-93] [RESERVOIR]
            SampleSize [95-103] [100 ROWS]
              IntLiteral(100) [95-98] [100]
            SampleSuffix [105-119] [REPEATABLE(10)]
              RepeatableClause [105-119] [REPEATABLE(10)]
                IntLiteral(10) [116-118] [10]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1)) AS t_pivot TABLESAMPLE RESERVOIR(100 ROWS) REPEATABLE (10)
--
ALTERNATION GROUP: <empty>
--
QueryStatement [0-109] [SELECT * FROM...REPEATABLE(10)]
  Query [0-109] [SELECT * FROM...REPEATABLE(10)]
    Select [0-109] [SELECT * FROM...REPEATABLE(10)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-109] [FROM t PIVOT...REPEATABLE(10)]
        TablePathExpression [14-109] [t PIVOT(SUM...REPEATABLE(10)]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-60] [PIVOT(SUM(...zero, 1))]
            PivotExpressionList [22-35] [SUM(a) AS sum]
              PivotExpression [22-35] [SUM(a) AS sum]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-35] [AS sum]
                  Identifier(sum) [32-35] [sum]
            PathExpression [40-41] [b]
              Identifier(b) [40-41] [b]
            PivotValueList [46-58] [0 AS zero, 1]
              PivotValue [46-55] [0 AS zero]
                IntLiteral(0) [46-47] [0]
                Alias [48-55] [AS zero]
                  Identifier(zero) [51-55] [zero]
              PivotValue [57-58] [1]
                IntLiteral(1) [57-58] [1]
          SampleClause [62-109] [TABLESAMPLE...REPEATABLE(10)]
            Identifier(RESERVOIR) [74-83] [RESERVOIR]
            SampleSize [85-93] [100 ROWS]
              IntLiteral(100) [85-88] [100]
            SampleSuffix [95-109] [REPEATABLE(10)]
              RepeatableClause [95-109] [REPEATABLE(10)]
                IntLiteral(10) [106-108] [10]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1)) TABLESAMPLE RESERVOIR(100 ROWS) REPEATABLE (10)
==

# PIVOT combined with TABLESAMPLE and alias
SELECT * FROM
t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
AS t_pivot TABLESAMPLE RESERVOIR (100 ROWS) REPEATABLE(10)
--
QueryStatement [0-119] [SELECT * FROM...REPEATABLE(10)]
  Query [0-119] [SELECT * FROM...REPEATABLE(10)]
    Select [0-119] [SELECT * FROM...REPEATABLE(10)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-119] [FROM t PIVOT...REPEATABLE(10)]
        TablePathExpression [14-119] [t PIVOT(SUM...REPEATABLE(10)]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-71] [PIVOT(SUM(...AS t_pivot]
            PivotExpressionList [22-35] [SUM(a) AS sum]
              PivotExpression [22-35] [SUM(a) AS sum]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-35] [AS sum]
                  Identifier(sum) [32-35] [sum]
            PathExpression [40-41] [b]
              Identifier(b) [40-41] [b]
            PivotValueList [46-58] [0 AS zero, 1]
              PivotValue [46-55] [0 AS zero]
                IntLiteral(0) [46-47] [0]
                Alias [48-55] [AS zero]
                  Identifier(zero) [51-55] [zero]
              PivotValue [57-58] [1]
                IntLiteral(1) [57-58] [1]
            Alias [61-71] [AS t_pivot]
              Identifier(t_pivot) [64-71] [t_pivot]
          SampleClause [72-119] [TABLESAMPLE...REPEATABLE(10)]
            Identifier(RESERVOIR) [84-93] [RESERVOIR]
            SampleSize [95-103] [100 ROWS]
              IntLiteral(100) [95-98] [100]
            SampleSuffix [105-119] [REPEATABLE(10)]
              RepeatableClause [105-119] [REPEATABLE(10)]
                IntLiteral(10) [116-118] [10]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1)) AS t_pivot TABLESAMPLE RESERVOIR(100 ROWS) REPEATABLE (10)
==

# PIVOT on time-travel table
SELECT * FROM
(SELECT * FROM t FOR SYSTEM TIME AS OF '2018-01-01')
PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
--
QueryStatement [0-111] [SELECT * FROM...zero, 1))]
  Query [0-111] [SELECT * FROM...zero, 1))]
    Select [0-111] [SELECT * FROM...zero, 1))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-111] [FROM (SELECT...zero, 1))]
        TableSubquery [14-111] [(SELECT *...zero, 1))]
          Query (pivot input) [15-65] [SELECT * FROM...2018-01-01']
            Select [15-65] [SELECT * FROM...2018-01-01']
              SelectList [22-23] [*]
                SelectColumn [22-23] [*]
                  Star(*) [22-23] [*]
              FromClause [24-65] [FROM t FOR...2018-01-01']
                TablePathExpression [29-65] [t FOR SYSTEM...2018-01-01']
                  PathExpression [29-30] [t]
                    Identifier(t) [29-30] [t]
                  ForSystemTime [31-65] [FOR SYSTEM...2018-01-01']
                    StringLiteral('2018-01-01') [53-65] ['2018-01-01']
          PivotClause [67-111] [PIVOT(SUM(...zero, 1))]
            PivotExpressionList [73-86] [SUM(a) AS sum]
              PivotExpression [73-86] [SUM(a) AS sum]
                FunctionCall [73-79] [SUM(a)]
                  PathExpression [73-76] [SUM]
                    Identifier(SUM) [73-76] [SUM]
                  PathExpression [77-78] [a]
                    Identifier(a) [77-78] [a]
                Alias [80-86] [AS sum]
                  Identifier(sum) [83-86] [sum]
            PathExpression [91-92] [b]
              Identifier(b) [91-92] [b]
            PivotValueList [97-109] [0 AS zero, 1]
              PivotValue [97-106] [0 AS zero]
                IntLiteral(0) [97-98] [0]
                Alias [99-106] [AS zero]
                  Identifier(zero) [102-106] [zero]
              PivotValue [108-109] [1]
                IntLiteral(1) [108-109] [1]
--
SELECT
  *
FROM
  (
    SELECT
      *
    FROM
      t FOR SYSTEM_TIME AS OF '2018-01-01'
  ) PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
==

# time-travel on pivot result
SELECT * FROM
t
PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
FOR SYSTEM TIME AS OF '2018-01-01';
--
ERROR: Syntax error: PIVOT and FOR SYSTEM TIME AS OF may not be combined [at 4:1]
FOR SYSTEM TIME AS OF '2018-01-01';
^
==

# Table alias named "PIVOT" - OK because PIVOT is a non-reserved keyword.
SELECT * FROM t PIVOT;
--
QueryStatement [0-21] [SELECT * FROM t PIVOT]
  Query [0-21] [SELECT * FROM t PIVOT]
    Select [0-21] [SELECT * FROM t PIVOT]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-21] [FROM t PIVOT]
        TablePathExpression [14-21] [t PIVOT]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [16-21] [PIVOT]
            Identifier(PIVOT) [16-21] [PIVOT]
--
SELECT
  *
FROM
  t AS PIVOT
==

# ERROR: Pivot clause containing only parens
SELECT * FROM t PIVOT();
--
ERROR: Syntax error: Unexpected ")" [at 1:23]
SELECT * FROM t PIVOT();
                      ^
==

# ERROR: Pivot clause with only pivot expr
SELECT * FROM t PIVOT(x);
--
ERROR: Syntax error: Unexpected ")" [at 1:24]
SELECT * FROM t PIVOT(x);
                       ^
==

# ERROR: Pivot clause with only pivot expr and FOR expr
SELECT * FROM t PIVOT(x FOR y);
--
ERROR: Syntax error: Unexpected ")" [at 1:30]
SELECT * FROM t PIVOT(x FOR y);
                             ^
==

# ERROR: Empty IN-list
SELECT * FROM t PIVOT(x FOR y IN ());
--
ERROR: Syntax error: Unexpected ")" [at 1:35]
SELECT * FROM t PIVOT(x FOR y IN ());
                                  ^
==

# ERROR: Trailing comma in IN-list
SELECT * FROM t PIVOT(x FOR y IN (0,));
--
ERROR: Syntax error: Unexpected ")" [at 1:37]
SELECT * FROM t PIVOT(x FOR y IN (0,));
                                    ^
==

# ERROR: Missing right-parenthesis
SELECT * FROM t PIVOT(x FOR y IN (0);
--
ERROR: Syntax error: Expected ")" but got ";" [at 1:37]
SELECT * FROM t PIVOT(x FOR y IN (0);
                                    ^
==

# ERROR: Missing pivot expression
SELECT * FROM t PIVOT(FOR y IN (0));
--
ERROR: Syntax error: Unexpected keyword FOR [at 1:23]
SELECT * FROM t PIVOT(FOR y IN (0));
                      ^
==

# ERROR: Trailing comma after last pivot expression
SELECT * FROM t PIVOT(SUM(x), SUM(y), FOR y IN (0));
--
ERROR: Syntax error: Unexpected keyword FOR [at 1:39]
SELECT * FROM t PIVOT(SUM(x), SUM(y), FOR y IN (0));
                                      ^
==

# PIVOT as identifier outside of table context
SELECT PIVOT;
--
QueryStatement [0-12] [SELECT PIVOT]
  Query [0-12] [SELECT PIVOT]
    Select [0-12] [SELECT PIVOT]
      SelectList [7-12] [PIVOT]
        SelectColumn [7-12] [PIVOT]
          PathExpression [7-12] [PIVOT]
            Identifier(PIVOT) [7-12] [PIVOT]
--
SELECT
  PIVOT
==

# PIVOT AS alias using AS keyword
SELECT * FROM t AS PIVOT;
--
QueryStatement [0-24] [SELECT * FROM t AS PIVOT]
  Query [0-24] [SELECT * FROM t AS PIVOT]
    Select [0-24] [SELECT * FROM t AS PIVOT]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-24] [FROM t AS PIVOT]
        TablePathExpression [14-24] [t AS PIVOT]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [16-24] [AS PIVOT]
            Identifier(PIVOT) [19-24] [PIVOT]
--
SELECT
  *
FROM
  t AS PIVOT
==

# PIVOT AS alias of table produced by a PIVOT clause.
SELECT * FROM t PIVOT(a FOR b IN (c)) PIVOT;
--
QueryStatement [0-43] [SELECT * FROM...(c)) PIVOT]
  Query [0-43] [SELECT * FROM...(c)) PIVOT]
    Select [0-43] [SELECT * FROM...(c)) PIVOT]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-43] [FROM t PIVOT...(c)) PIVOT]
        TablePathExpression [14-43] [t PIVOT(a FOR b IN (c)) PIVOT]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-43] [PIVOT(a FOR b IN (c)) PIVOT]
            PivotExpressionList [22-23] [a]
              PivotExpression [22-23] [a]
                PathExpression [22-23] [a]
                  Identifier(a) [22-23] [a]
            PathExpression [28-29] [b]
              Identifier(b) [28-29] [b]
            PivotValueList [34-35] [c]
              PivotValue [34-35] [c]
                PathExpression [34-35] [c]
                  Identifier(c) [34-35] [c]
            Alias [38-43] [PIVOT]
              Identifier(PIVOT) [38-43] [PIVOT]
--
SELECT
  *
FROM
  t PIVOT(a FOR b IN (c)) AS PIVOT
==

# TVF named "PIVOT".
SELECT * FROM PIVOT(t);
--
QueryStatement [0-22] [SELECT * FROM PIVOT(t)]
  Query [0-22] [SELECT * FROM PIVOT(t)]
    Select [0-22] [SELECT * FROM PIVOT(t)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-22] [FROM PIVOT(t)]
        TVF [14-22] [PIVOT(t)]
          PathExpression [14-19] [PIVOT]
            Identifier(PIVOT) [14-19] [PIVOT]
          TVFArgument [20-21] [t]
            PathExpression [20-21] [t]
              Identifier(t) [20-21] [t]
--
SELECT
  *
FROM
  PIVOT(t)
==

# PIVOT with empty IN-list
SELECT * FROM t PIVOT(SUM(a) FOR b IN ());
--
ERROR: Syntax error: Unexpected ")" [at 1:40]
SELECT * FROM t PIVOT(SUM(a) FOR b IN ());
                                       ^
==

# PIVOT combined with TABLESAMPLE and alias (without AS keyword)
SELECT * FROM
t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1))
t_pivot TABLESAMPLE RESERVOIR (100 ROWS) REPEATABLE(10)
--
QueryStatement [0-116] [SELECT * FROM...REPEATABLE(10)]
  Query [0-116] [SELECT * FROM...REPEATABLE(10)]
    Select [0-116] [SELECT * FROM...REPEATABLE(10)]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-116] [FROM t PIVOT...REPEATABLE(10)]
        TablePathExpression [14-116] [t PIVOT(SUM...REPEATABLE(10)]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-68] [PIVOT(SUM(...)) t_pivot]
            PivotExpressionList [22-35] [SUM(a) AS sum]
              PivotExpression [22-35] [SUM(a) AS sum]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
                Alias [29-35] [AS sum]
                  Identifier(sum) [32-35] [sum]
            PathExpression [40-41] [b]
              Identifier(b) [40-41] [b]
            PivotValueList [46-58] [0 AS zero, 1]
              PivotValue [46-55] [0 AS zero]
                IntLiteral(0) [46-47] [0]
                Alias [48-55] [AS zero]
                  Identifier(zero) [51-55] [zero]
              PivotValue [57-58] [1]
                IntLiteral(1) [57-58] [1]
            Alias [61-68] [t_pivot]
              Identifier(t_pivot) [61-68] [t_pivot]
          SampleClause [69-116] [TABLESAMPLE...REPEATABLE(10)]
            Identifier(RESERVOIR) [81-90] [RESERVOIR]
            SampleSize [92-100] [100 ROWS]
              IntLiteral(100) [92-95] [100]
            SampleSuffix [102-116] [REPEATABLE(10)]
              RepeatableClause [102-116] [REPEATABLE(10)]
                IntLiteral(10) [113-115] [10]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1)) AS t_pivot TABLESAMPLE RESERVOIR(100 ROWS) REPEATABLE (10)
==

# Complex pivot value exprs
SELECT * FROM t PIVOT(SUM(a) FOR b IN (1+2+3, 4+5+6));
--
QueryStatement [0-53] [SELECT * FROM...3, 4+5+6))]
  Query [0-53] [SELECT * FROM...3, 4+5+6))]
    Select [0-53] [SELECT * FROM...3, 4+5+6))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-53] [FROM t PIVOT...3, 4+5+6))]
        TablePathExpression [14-53] [t PIVOT(SUM...3, 4+5+6))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-53] [PIVOT(SUM(...3, 4+5+6))]
            PivotExpressionList [22-28] [SUM(a)]
              PivotExpression [22-28] [SUM(a)]
                FunctionCall [22-28] [SUM(a)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [a]
                    Identifier(a) [26-27] [a]
            PathExpression [33-34] [b]
              Identifier(b) [33-34] [b]
            PivotValueList [39-51] [1+2+3, 4+5+6]
              PivotValue [39-44] [1+2+3]
                BinaryExpression(+) [39-44] [1+2+3]
                  BinaryExpression(+) [39-42] [1+2]
                    IntLiteral(1) [39-40] [1]
                    IntLiteral(2) [41-42] [2]
                  IntLiteral(3) [43-44] [3]
              PivotValue [46-51] [4+5+6]
                BinaryExpression(+) [46-51] [4+5+6]
                  BinaryExpression(+) [46-49] [4+5]
                    IntLiteral(4) [46-47] [4]
                    IntLiteral(5) [48-49] [5]
                  IntLiteral(6) [50-51] [6]
--
SELECT
  *
FROM
  t PIVOT(SUM(a) FOR b IN (1 + 2 + 3, 4 + 5 + 6))
==

# ERROR: Multiple pivot modifiers on the same table
SELECT * FROM t
PIVOT(SUM(a) FOR b IN (1, 2))
PIVOT(SUM(a) FOR b IN (3, 4));
--
ERROR: Syntax error: Expected end of input but got "(" [at 3:6]
PIVOT(SUM(a) FOR b IN (3, 4));
     ^
==

# ERROR: Trailing comma after IN list
SELECT * FROM t
PIVOT(SUM(a) FOR b IN (1, 2,))
--
ERROR: Syntax error: Unexpected ")" [at 2:29]
PIVOT(SUM(a) FOR b IN (1, 2,))
                            ^
==

# ERROR: Trailing comma after pivot expr list
SELECT * FROM t
PIVOT(SUM(a), AVG(a), FOR b IN (1, 2,))
--
ERROR: Syntax error: Unexpected keyword FOR [at 2:23]
PIVOT(SUM(a), AVG(a), FOR b IN (1, 2,))
                      ^
==

# The SQL Standard allows a parenthesized column list to follow a table alias.
# ZetaSQL does not support this, but make sure that, when the table alias is
# "PIVOT", the query fails.
SELECT * FROM t PIVOT({{x|x,|x,y|x,y,}});
--
ALTERNATION GROUP: x
--
ERROR: Syntax error: Unexpected ")" [at 1:24]
SELECT * FROM t PIVOT(x);
                       ^
--
ALTERNATION GROUP: x,
--
ERROR: Syntax error: Unexpected ")" [at 1:25]
SELECT * FROM t PIVOT(x,);
                        ^
--
ALTERNATION GROUP: x,y
--
ERROR: Syntax error: Unexpected ")" [at 1:26]
SELECT * FROM t PIVOT(x,y);
                         ^
--
ALTERNATION GROUP: x,y,
--
ERROR: Syntax error: Unexpected ")" [at 1:27]
SELECT * FROM t PIVOT(x,y,);
                          ^
==

# WITH OFFSET on pivot result (with and without alias)
SELECT * FROM
t
PIVOT(SUM(a) AS sum FOR b IN (0 AS zero, 1)) {{AS t_alias|t_alias|}}
WITH OFFSET {{AS t_alias|t_alias|}};
--
ALTERNATION GROUPS:
    AS t_alias,AS t_alias
    t_alias,AS t_alias
    AS t_alias
--
ERROR: PIVOT and WITH OFFSET cannot be combined [at 4:1]
WITH OFFSET AS t_alias;
^
--
ALTERNATION GROUPS:
    AS t_alias,t_alias
    t_alias,t_alias
    t_alias
--
ERROR: PIVOT and WITH OFFSET cannot be combined [at 4:1]
WITH OFFSET t_alias;
^
--
ALTERNATION GROUPS:
    AS t_alias,
    t_alias,
    <empty>
--
ERROR: PIVOT and WITH OFFSET cannot be combined [at 4:1]
WITH OFFSET ;
^
==

# Alias on input table of PIVOT, both with and without AS keyword.
SELECT * FROM t {{AS|}} t1 PIVOT(a FOR b IN (c));
--
ALTERNATION GROUP: AS
--
QueryStatement [0-43] [SELECT * FROM...b IN (c))]
  Query [0-43] [SELECT * FROM...b IN (c))]
    Select [0-43] [SELECT * FROM...b IN (c))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-43] [FROM t AS...b IN (c))]
        TablePathExpression [14-43] [t AS t1 PIVOT(a FOR b IN (c))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [16-21] [AS t1]
            Identifier(t1) [19-21] [t1]
          PivotClause [22-43] [PIVOT(a FOR b IN (c))]
            PivotExpressionList [28-29] [a]
              PivotExpression [28-29] [a]
                PathExpression [28-29] [a]
                  Identifier(a) [28-29] [a]
            PathExpression [34-35] [b]
              Identifier(b) [34-35] [b]
            PivotValueList [40-41] [c]
              PivotValue [40-41] [c]
                PathExpression [40-41] [c]
                  Identifier(c) [40-41] [c]
--
SELECT
  *
FROM
  t AS t1 PIVOT(a FOR b IN (c))
--
ALTERNATION GROUP: <empty>
--
QueryStatement [0-41] [SELECT * FROM...b IN (c))]
  Query [0-41] [SELECT * FROM...b IN (c))]
    Select [0-41] [SELECT * FROM...b IN (c))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-41] [FROM t  t1...b IN (c))]
        TablePathExpression [14-41] [t  t1 PIVOT(a FOR b IN (c))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [17-19] [t1]
            Identifier(t1) [17-19] [t1]
          PivotClause [20-41] [PIVOT(a FOR b IN (c))]
            PivotExpressionList [26-27] [a]
              PivotExpression [26-27] [a]
                PathExpression [26-27] [a]
                  Identifier(a) [26-27] [a]
            PathExpression [32-33] [b]
              Identifier(b) [32-33] [b]
            PivotValueList [38-39] [c]
              PivotValue [38-39] [c]
                PathExpression [38-39] [c]
                  Identifier(c) [38-39] [c]
--
SELECT
  *
FROM
  t AS t1 PIVOT(a FOR b IN (c))
==

# Alias on both input table and result of PIVOT,
# both with and without AS keyword.
SELECT * FROM t {{AS|}} t1 PIVOT(a FOR b IN (c)) {{AS|}} t2;
--
ALTERNATION GROUP: AS,AS
--
QueryStatement [0-49] [SELECT * FROM...(c)) AS t2]
  Query [0-49] [SELECT * FROM...(c)) AS t2]
    Select [0-49] [SELECT * FROM...(c)) AS t2]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-49] [FROM t AS...(c)) AS t2]
        TablePathExpression [14-49] [t AS t1 PIVOT...(c)) AS t2]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [16-21] [AS t1]
            Identifier(t1) [19-21] [t1]
          PivotClause [22-49] [PIVOT(a FOR b IN (c)) AS t2]
            PivotExpressionList [28-29] [a]
              PivotExpression [28-29] [a]
                PathExpression [28-29] [a]
                  Identifier(a) [28-29] [a]
            PathExpression [34-35] [b]
              Identifier(b) [34-35] [b]
            PivotValueList [40-41] [c]
              PivotValue [40-41] [c]
                PathExpression [40-41] [c]
                  Identifier(c) [40-41] [c]
            Alias [44-49] [AS t2]
              Identifier(t2) [47-49] [t2]
--
SELECT
  *
FROM
  t AS t1 PIVOT(a FOR b IN (c)) AS t2
--
ALTERNATION GROUP: AS,
--
QueryStatement [0-47] [SELECT * FROM...IN (c))  t2]
  Query [0-47] [SELECT * FROM...IN (c))  t2]
    Select [0-47] [SELECT * FROM...IN (c))  t2]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-47] [FROM t AS...IN (c))  t2]
        TablePathExpression [14-47] [t AS t1 PIVOT...IN (c))  t2]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [16-21] [AS t1]
            Identifier(t1) [19-21] [t1]
          PivotClause [22-47] [PIVOT(a FOR b IN (c))  t2]
            PivotExpressionList [28-29] [a]
              PivotExpression [28-29] [a]
                PathExpression [28-29] [a]
                  Identifier(a) [28-29] [a]
            PathExpression [34-35] [b]
              Identifier(b) [34-35] [b]
            PivotValueList [40-41] [c]
              PivotValue [40-41] [c]
                PathExpression [40-41] [c]
                  Identifier(c) [40-41] [c]
            Alias [45-47] [t2]
              Identifier(t2) [45-47] [t2]
--
SELECT
  *
FROM
  t AS t1 PIVOT(a FOR b IN (c)) AS t2
--
ALTERNATION GROUP: AS
--
QueryStatement [0-47] [SELECT * FROM...(c)) AS t2]
  Query [0-47] [SELECT * FROM...(c)) AS t2]
    Select [0-47] [SELECT * FROM...(c)) AS t2]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-47] [FROM t  t1...(c)) AS t2]
        TablePathExpression [14-47] [t  t1 PIVOT...(c)) AS t2]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [17-19] [t1]
            Identifier(t1) [17-19] [t1]
          PivotClause [20-47] [PIVOT(a FOR b IN (c)) AS t2]
            PivotExpressionList [26-27] [a]
              PivotExpression [26-27] [a]
                PathExpression [26-27] [a]
                  Identifier(a) [26-27] [a]
            PathExpression [32-33] [b]
              Identifier(b) [32-33] [b]
            PivotValueList [38-39] [c]
              PivotValue [38-39] [c]
                PathExpression [38-39] [c]
                  Identifier(c) [38-39] [c]
            Alias [42-47] [AS t2]
              Identifier(t2) [45-47] [t2]
--
SELECT
  *
FROM
  t AS t1 PIVOT(a FOR b IN (c)) AS t2
--
ALTERNATION GROUP: <empty>
--
QueryStatement [0-45] [SELECT * FROM...IN (c))  t2]
  Query [0-45] [SELECT * FROM...IN (c))  t2]
    Select [0-45] [SELECT * FROM...IN (c))  t2]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-45] [FROM t  t1...IN (c))  t2]
        TablePathExpression [14-45] [t  t1 PIVOT...IN (c))  t2]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          Alias [17-19] [t1]
            Identifier(t1) [17-19] [t1]
          PivotClause [20-45] [PIVOT(a FOR b IN (c))  t2]
            PivotExpressionList [26-27] [a]
              PivotExpression [26-27] [a]
                PathExpression [26-27] [a]
                  Identifier(a) [26-27] [a]
            PathExpression [32-33] [b]
              Identifier(b) [32-33] [b]
            PivotValueList [38-39] [c]
              PivotValue [38-39] [c]
                PathExpression [38-39] [c]
                  Identifier(c) [38-39] [c]
            Alias [43-45] [t2]
              Identifier(t2) [43-45] [t2]
--
SELECT
  *
FROM
  t AS t1 PIVOT(a FOR b IN (c)) AS t2
==

# PIVOT on UNNEST() is an error on the resolver (because unnest() returns
# a value table), but it's allowed on the parser layer.
# Test both with and without a WITH OFFSET clause.
SELECT * FROM UNNEST([1, 2, 3]) {{WITH OFFSET|WITH OFFSET x|WITH OFFSET AS x|}}
PIVOT(SUM(x) FOR x IN (4, 5)) AS x;
--
ALTERNATION GROUP: WITH OFFSET
--
ERROR: Syntax error: Expected end of input but got "(" [at 2:6]
PIVOT(SUM(x) FOR x IN (4, 5)) AS x;
     ^
--
ALTERNATION GROUPS:
    WITH OFFSET x
    WITH OFFSET AS x
--
ERROR: Syntax error: Expected end of input but got keyword PIVOT [at 2:1]
PIVOT(SUM(x) FOR x IN (4, 5)) AS x;
^
--
ALTERNATION GROUP: <empty>
--
QueryStatement [0-67] [SELECT * FROM..., 5)) AS x]
  Query [0-67] [SELECT * FROM..., 5)) AS x]
    Select [0-67] [SELECT * FROM..., 5)) AS x]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-67] [FROM UNNEST..., 5)) AS x]
        TablePathExpression [14-67] [UNNEST([1,..., 5)) AS x]
          UnnestExpression [14-31] [UNNEST([1, 2, 3])]
            ArrayConstructor [21-30] [[1, 2, 3]]
              IntLiteral(1) [22-23] [1]
              IntLiteral(2) [25-26] [2]
              IntLiteral(3) [28-29] [3]
          PivotClause [33-67] [PIVOT(SUM(..., 5)) AS x]
            PivotExpressionList [39-45] [SUM(x)]
              PivotExpression [39-45] [SUM(x)]
                FunctionCall [39-45] [SUM(x)]
                  PathExpression [39-42] [SUM]
                    Identifier(SUM) [39-42] [SUM]
                  PathExpression [43-44] [x]
                    Identifier(x) [43-44] [x]
            PathExpression [50-51] [x]
              Identifier(x) [50-51] [x]
            PivotValueList [56-60] [4, 5]
              PivotValue [56-57] [4]
                IntLiteral(4) [56-57] [4]
              PivotValue [59-60] [5]
                IntLiteral(5) [59-60] [5]
            Alias [63-67] [AS x]
              Identifier(x) [66-67] [x]
--
SELECT
  *
FROM
  UNNEST(ARRAY[1, 2, 3]) PIVOT(SUM(x) FOR x IN (4, 5)) AS x
==

# ERROR: qualified alias for pivot input
SELECT * FROM t p.d.t1 PIVOT(a FOR b IN (c)) {{AS|}} t2;
--
ALTERNATION GROUP: AS
--
ERROR: Syntax error: Expected end of input but got "." [at 1:18]
SELECT * FROM t p.d.t1 PIVOT(a FOR b IN (c)) AS t2;
                 ^
--
ALTERNATION GROUP: <empty>
--
ERROR: Syntax error: Expected end of input but got "." [at 1:18]
SELECT * FROM t p.d.t1 PIVOT(a FOR b IN (c))  t2;
                 ^
==

# ERROR: qualified alias for pivot output
SELECT * FROM t t1 PIVOT(a FOR b IN (c)) {{AS|}} p.d.t2;
--
ALTERNATION GROUP: AS
--
ERROR: Syntax error: Expected end of input but got "." [at 1:46]
SELECT * FROM t t1 PIVOT(a FOR b IN (c)) AS p.d.t2;
                                             ^
--
ALTERNATION GROUP: <empty>
--
ERROR: Syntax error: Expected end of input but got "." [at 1:44]
SELECT * FROM t t1 PIVOT(a FOR b IN (c))  p.d.t2;
                                           ^
==

# Qualified references to column from input table within pivot clause
SELECT * FROM t PIVOT(t.a FOR t.b IN (c)) {{AS|}} t2;
--
ALTERNATION GROUP: AS
--
QueryStatement [0-47] [SELECT * FROM...(c)) AS t2]
  Query [0-47] [SELECT * FROM...(c)) AS t2]
    Select [0-47] [SELECT * FROM...(c)) AS t2]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-47] [FROM t PIVOT...(c)) AS t2]
        TablePathExpression [14-47] [t PIVOT(t....(c)) AS t2]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-47] [PIVOT(t.a...(c)) AS t2]
            PivotExpressionList [22-25] [t.a]
              PivotExpression [22-25] [t.a]
                PathExpression [22-25] [t.a]
                  Identifier(t) [22-23] [t]
                  Identifier(a) [24-25] [a]
            PathExpression [30-33] [t.b]
              Identifier(t) [30-31] [t]
              Identifier(b) [32-33] [b]
            PivotValueList [38-39] [c]
              PivotValue [38-39] [c]
                PathExpression [38-39] [c]
                  Identifier(c) [38-39] [c]
            Alias [42-47] [AS t2]
              Identifier(t2) [45-47] [t2]
--
SELECT
  *
FROM
  t PIVOT(t.a FOR t.b IN (c)) AS t2
--
ALTERNATION GROUP: <empty>
--
QueryStatement [0-45] [SELECT * FROM...IN (c))  t2]
  Query [0-45] [SELECT * FROM...IN (c))  t2]
    Select [0-45] [SELECT * FROM...IN (c))  t2]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-45] [FROM t PIVOT...IN (c))  t2]
        TablePathExpression [14-45] [t PIVOT(t....IN (c))  t2]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-45] [PIVOT(t.a FOR t.b IN (c))  t2]
            PivotExpressionList [22-25] [t.a]
              PivotExpression [22-25] [t.a]
                PathExpression [22-25] [t.a]
                  Identifier(t) [22-23] [t]
                  Identifier(a) [24-25] [a]
            PathExpression [30-33] [t.b]
              Identifier(t) [30-31] [t]
              Identifier(b) [32-33] [b]
            PivotValueList [38-39] [c]
              PivotValue [38-39] [c]
                PathExpression [38-39] [c]
                  Identifier(c) [38-39] [c]
            Alias [43-45] [t2]
              Identifier(t2) [43-45] [t2]
--
SELECT
  *
FROM
  t PIVOT(t.a FOR t.b IN (c)) AS t2
==

# FOR expr with its own IN clause (no parentheses)
SELECT * FROM t
PIVOT(SUM(x) FOR y IN (1, 2) IN (TRUE, FALSE));
--
ERROR: Syntax error: Expected ")" but got keyword IN [at 2:30]
PIVOT(SUM(x) FOR y IN (1, 2) IN (TRUE, FALSE));
                             ^
==

# FOR expr with its own IN clause (with parentheses)
SELECT * FROM t
PIVOT(SUM(x) FOR (y IN (1, 2)) IN (TRUE, FALSE));
--
QueryStatement [0-64] [SELECT * FROM...TRUE, FALSE))]
  Query [0-64] [SELECT * FROM...TRUE, FALSE))]
    Select [0-64] [SELECT * FROM...TRUE, FALSE))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-64] [FROM t PIVOT...TRUE, FALSE))]
        TablePathExpression [14-64] [t PIVOT(SUM...TRUE, FALSE))]
          PathExpression [14-15] [t]
            Identifier(t) [14-15] [t]
          PivotClause [16-64] [PIVOT(SUM(...TRUE, FALSE))]
            PivotExpressionList [22-28] [SUM(x)]
              PivotExpression [22-28] [SUM(x)]
                FunctionCall [22-28] [SUM(x)]
                  PathExpression [22-25] [SUM]
                    Identifier(SUM) [22-25] [SUM]
                  PathExpression [26-27] [x]
                    Identifier(x) [26-27] [x]
            InExpression(IN) [34-45] [y IN (1, 2)]
              PathExpression [34-35] [y]
                Identifier(y) [34-35] [y]
              Location [36-38] [IN]
              InList [40-44] [1, 2]
                IntLiteral(1) [40-41] [1]
                IntLiteral(2) [43-44] [2]
            PivotValueList [51-62] [TRUE, FALSE]
              PivotValue [51-55] [TRUE]
                BooleanLiteral(TRUE) [51-55] [TRUE]
              PivotValue [57-62] [FALSE]
                BooleanLiteral(FALSE) [57-62] [FALSE]
--
SELECT
  *
FROM
  t PIVOT(SUM(x) FOR(y IN (1, 2)) IN (TRUE, FALSE))
==

# Subqueries nested inside pivot input are not marked as pivot input.
SELECT * FROM (SELECT * FROM (SELECT * FROM t)) PIVOT (SUM(x) FOR y IN (1, 2));
--
QueryStatement [0-78] [SELECT * FROM...IN (1, 2))]
  Query [0-78] [SELECT * FROM...IN (1, 2))]
    Select [0-78] [SELECT * FROM...IN (1, 2))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-78] [FROM (SELECT...IN (1, 2))]
        TableSubquery [14-78] [(SELECT *...IN (1, 2))]
          Query (pivot input) [15-46] [SELECT * FROM...* FROM t)]
            Select [15-46] [SELECT * FROM...* FROM t)]
              SelectList [22-23] [*]
                SelectColumn [22-23] [*]
                  Star(*) [22-23] [*]
              FromClause [24-46] [FROM (SELECT * FROM t)]
                TableSubquery [29-46] [(SELECT * FROM t)]
                  Query [30-45] [SELECT * FROM t]
                    Select [30-45] [SELECT * FROM t]
                      SelectList [37-38] [*]
                        SelectColumn [37-38] [*]
                          Star(*) [37-38] [*]
                      FromClause [39-45] [FROM t]
                        TablePathExpression [44-45] [t]
                          PathExpression [44-45] [t]
                            Identifier(t) [44-45] [t]
          PivotClause [48-78] [PIVOT (SUM(x) FOR y IN (1, 2))]
            PivotExpressionList [55-61] [SUM(x)]
              PivotExpression [55-61] [SUM(x)]
                FunctionCall [55-61] [SUM(x)]
                  PathExpression [55-58] [SUM]
                    Identifier(SUM) [55-58] [SUM]
                  PathExpression [59-60] [x]
                    Identifier(x) [59-60] [x]
            PathExpression [66-67] [y]
              Identifier(y) [66-67] [y]
            PivotValueList [72-76] [1, 2]
              PivotValue [72-73] [1]
                IntLiteral(1) [72-73] [1]
              PivotValue [75-76] [2]
                IntLiteral(2) [75-76] [2]
--
SELECT
  *
FROM
  (
    SELECT
      *
    FROM
      (
        SELECT
          *
        FROM
          t
      )
  ) PIVOT(SUM(x) FOR y IN (1, 2))
==

# When a pivot input query uses a WITH clause, the main query is still marked as
# pivot input (but the with entry subqueries are not)
SELECT * FROM (
  WITH tt AS (SELECT 1 FROM t)
  SELECT * FROM tt)
  PIVOT (SUM(x) FOR y IN (1, 2));
--
QueryStatement [0-99] [SELECT * FROM...IN (1, 2))]
  Query [0-99] [SELECT * FROM...IN (1, 2))]
    Select [0-99] [SELECT * FROM...IN (1, 2))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-99] [FROM (   WITH...IN (1, 2))]
        TableSubquery [14-99] [(   WITH tt...IN (1, 2))]
          Query (pivot input) [18-65] [WITH tt AS...* FROM tt]
            WithClause [18-46] [WITH tt AS (SELECT 1 FROM t)]
              WithClauseEntry [23-46] [tt AS (SELECT 1 FROM t)]
                Identifier(tt) [23-25] [tt]
                Query [30-45] [SELECT 1 FROM t]
                  Select [30-45] [SELECT 1 FROM t]
                    SelectList [37-38] [1]
                      SelectColumn [37-38] [1]
                        IntLiteral(1) [37-38] [1]
                    FromClause [39-45] [FROM t]
                      TablePathExpression [44-45] [t]
                        PathExpression [44-45] [t]
                          Identifier(t) [44-45] [t]
            Select [49-65] [SELECT * FROM tt]
              SelectList [56-57] [*]
                SelectColumn [56-57] [*]
                  Star(*) [56-57] [*]
              FromClause [58-65] [FROM tt]
                TablePathExpression [63-65] [tt]
                  PathExpression [63-65] [tt]
                    Identifier(tt) [63-65] [tt]
          PivotClause [69-99] [PIVOT (SUM(x) FOR y IN (1, 2))]
            PivotExpressionList [76-82] [SUM(x)]
              PivotExpression [76-82] [SUM(x)]
                FunctionCall [76-82] [SUM(x)]
                  PathExpression [76-79] [SUM]
                    Identifier(SUM) [76-79] [SUM]
                  PathExpression [80-81] [x]
                    Identifier(x) [80-81] [x]
            PathExpression [87-88] [y]
              Identifier(y) [87-88] [y]
            PivotValueList [93-97] [1, 2]
              PivotValue [93-94] [1]
                IntLiteral(1) [93-94] [1]
              PivotValue [96-97] [2]
                IntLiteral(2) [96-97] [2]
--
SELECT
  *
FROM
  (WITH
      tt AS (
        SELECT
          1
        FROM
          t
      )
    SELECT
      *
    FROM
      tt
  ) PIVOT(SUM(x) FOR y IN (1, 2))
==

# Inputs to a set operation used as pivot input are not marked as pivot input
SELECT * FROM (
  SELECT a, b FROM t1
  UNION ALL (SELECT c, d FROM t2)
) PIVOT (SUM(x) FOR y IN (1, 2));
--
QueryStatement [0-104] [SELECT * FROM...IN (1, 2))]
  Query [0-104] [SELECT * FROM...IN (1, 2))]
    Select [0-104] [SELECT * FROM...IN (1, 2))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-104] [FROM (   SELECT...IN (1, 2))]
        TableSubquery [14-104] [(   SELECT...IN (1, 2))]
          Query (pivot input) [18-71] [SELECT a,...d FROM t2)]
            SetOperation(UNION ALL) [18-71] [SELECT a,...d FROM t2)]
              Select [18-37] [SELECT a, b FROM t1]
                SelectList [25-29] [a, b]
                  SelectColumn [25-26] [a]
                    PathExpression [25-26] [a]
                      Identifier(a) [25-26] [a]
                  SelectColumn [28-29] [b]
                    PathExpression [28-29] [b]
                      Identifier(b) [28-29] [b]
                FromClause [30-37] [FROM t1]
                  TablePathExpression [35-37] [t1]
                    PathExpression [35-37] [t1]
                      Identifier(t1) [35-37] [t1]
              Query [51-70] [SELECT c, d FROM t2]
                Select [51-70] [SELECT c, d FROM t2]
                  SelectList [58-62] [c, d]
                    SelectColumn [58-59] [c]
                      PathExpression [58-59] [c]
                        Identifier(c) [58-59] [c]
                    SelectColumn [61-62] [d]
                      PathExpression [61-62] [d]
                        Identifier(d) [61-62] [d]
                  FromClause [63-70] [FROM t2]
                    TablePathExpression [68-70] [t2]
                      PathExpression [68-70] [t2]
                        Identifier(t2) [68-70] [t2]
          PivotClause [74-104] [PIVOT (SUM(x) FOR y IN (1, 2))]
            PivotExpressionList [81-87] [SUM(x)]
              PivotExpression [81-87] [SUM(x)]
                FunctionCall [81-87] [SUM(x)]
                  PathExpression [81-84] [SUM]
                    Identifier(SUM) [81-84] [SUM]
                  PathExpression [85-86] [x]
                    Identifier(x) [85-86] [x]
            PathExpression [92-93] [y]
              Identifier(y) [92-93] [y]
            PivotValueList [98-102] [1, 2]
              PivotValue [98-99] [1]
                IntLiteral(1) [98-99] [1]
              PivotValue [101-102] [2]
                IntLiteral(2) [101-102] [2]
--
SELECT
  *
FROM
  (
    SELECT
      a,
      b
    FROM
      t1
    UNION ALL(
    SELECT
      c,
      d
    FROM
      t2
    )
  ) PIVOT(SUM(x) FOR y IN (1, 2))
==

# Inputs to a join operation used as pivot input are not marked as pivot input
SELECT * FROM (
  SELECT a, b FROM t1
  INNER JOIN (SELECT c, d FROM t2) ON (a = c)
) PIVOT (SUM(x) FOR y IN (1, 2));
--
QueryStatement [0-116] [SELECT * FROM...IN (1, 2))]
  Query [0-116] [SELECT * FROM...IN (1, 2))]
    Select [0-116] [SELECT * FROM...IN (1, 2))]
      SelectList [7-8] [*]
        SelectColumn [7-8] [*]
          Star(*) [7-8] [*]
      FromClause [9-116] [FROM (   SELECT...IN (1, 2))]
        TableSubquery [14-116] [(   SELECT...IN (1, 2))]
          Query (pivot input) [18-83] [SELECT a,...ON (a = c)]
            Select [18-83] [SELECT a,...ON (a = c)]
              SelectList [25-29] [a, b]
                SelectColumn [25-26] [a]
                  PathExpression [25-26] [a]
                    Identifier(a) [25-26] [a]
                SelectColumn [28-29] [b]
                  PathExpression [28-29] [b]
                    Identifier(b) [28-29] [b]
              FromClause [30-83] [FROM t1...ON (a = c)]
                Join(INNER) [35-83] [t1   INNER...ON (a = c)]
                  TablePathExpression [35-37] [t1]
                    PathExpression [35-37] [t1]
                      Identifier(t1) [35-37] [t1]
                  Location [40-50] [INNER JOIN]
                  TableSubquery [51-72] [(SELECT c, d FROM t2)]
                    Query [52-71] [SELECT c, d FROM t2]
                      Select [52-71] [SELECT c, d FROM t2]
                        SelectList [59-63] [c, d]
                          SelectColumn [59-60] [c]
                            PathExpression [59-60] [c]
                              Identifier(c) [59-60] [c]
                          SelectColumn [62-63] [d]
                            PathExpression [62-63] [d]
                              Identifier(d) [62-63] [d]
                        FromClause [64-71] [FROM t2]
                          TablePathExpression [69-71] [t2]
                            PathExpression [69-71] [t2]
                              Identifier(t2) [69-71] [t2]
                  OnClause [73-83] [ON (a = c)]
                    BinaryExpression(=) [77-82] [a = c]
                      PathExpression [77-78] [a]
                        Identifier(a) [77-78] [a]
                      PathExpression [81-82] [c]
                        Identifier(c) [81-82] [c]
          PivotClause [86-116] [PIVOT (SUM(x) FOR y IN (1, 2))]
            PivotExpressionList [93-99] [SUM(x)]
              PivotExpression [93-99] [SUM(x)]
                FunctionCall [93-99] [SUM(x)]
                  PathExpression [93-96] [SUM]
                    Identifier(SUM) [93-96] [SUM]
                  PathExpression [97-98] [x]
                    Identifier(x) [97-98] [x]
            PathExpression [104-105] [y]
              Identifier(y) [104-105] [y]
            PivotValueList [110-114] [1, 2]
              PivotValue [110-111] [1]
                IntLiteral(1) [110-111] [1]
              PivotValue [113-114] [2]
                IntLiteral(2) [113-114] [2]
--
SELECT
  *
FROM
  (
    SELECT
      a,
      b
    FROM
      t1
      INNER JOIN
      (
        SELECT
          c,
          d
        FROM
          t2
      )
      ON (a = c)
  ) PIVOT(SUM(x) FOR y IN (1, 2))
